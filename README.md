# Coffee Shop API

**–ü—Ä–æ–µ–∫—Ç FastAPI** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π.

---

## üöÄ **–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞**

‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π email
‚úÖ JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (access –∏ refresh —Ç–æ–∫–µ–Ω—ã)
‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ refresh —Ç–æ–∫–µ–Ω–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ blacklist –¥–ª—è –æ—Ç–æ–∑–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
‚úÖ –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (Admin –∏ User)
‚úÖ –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (CRUD)
‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π SQLAlchemy (PostgreSQL)
‚úÖ A—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (DAO + —Å–µ—Ä–≤–∏—Å—ã)

---

## üõ†Ô∏è **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫**

* **FastAPI** (backend framework)
* **SQLAlchemy** async ORM
* **PostgreSQL** (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
* **Alembic** (–º–∏–≥—Ä–∞—Ü–∏–∏)
* **Pydantic** (–≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å—Ö–µ–º—ã)
* **JWT (python-jose)** –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
* **Passlib (bcrypt)** –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
* **Docker –∏ docker-compose** (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è)

---

## üìÇ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞**

```
app/
  ‚îú‚îÄ‚îÄ config/            # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
  ‚îú‚îÄ‚îÄ routers/           # –†–æ—É—Ç–µ—Ä—ã (auth, users)
  ‚îú‚îÄ‚îÄ models/            # SQLAlchemy –º–æ–¥–µ–ª–∏
  ‚îú‚îÄ‚îÄ schemas/           # Pydantic —Å—Ö–µ–º—ã
  ‚îú‚îÄ‚îÄ services/          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (DAO, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤)
  ‚îú‚îÄ‚îÄ deps/              # Dependency injection
  ‚îú‚îÄ‚îÄ custom_jwt/        # JWT utils, SQLAlchemy –º–æ–¥–µ–ª–∏, DAO 
main.py                  # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è FastAPI
```

---

## ‚öôÔ∏è **–ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞**

### ‚úÖ **1. –ö–ª–æ–Ω–∏—Ä—É–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**

```bash
git clone https://github.com/IslombekOrifov/coffee-shop-api.git
cd coffee-shop-api
```

---

### ‚úÖ **2. –ù–∞—Å—Ç—Ä–æ–π .env —Ñ–∞–π–ª**

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```
SECRETF_KEY=your_new_secret_key
DEBUG=False

DB_HOST=coffee_db
DB_PORT=5432
DB_USER=admin
DB_PASS=admin
DB_NAME=cofee_shop

EMAIL_HOST_USER=your_user
EMAIL_HOST_PASSWORD=your pass
EMAIL_PORT=587

CELERY_BROKER_URL=redis://coffee_redis:6379/0
CELERY_RESULT_BACKEND=redis://coffee_redis:6379/1
```

---

### ‚úÖ **3. –ó–∞–ø—É—Å—Ç–∏ —á–µ—Ä–µ–∑ Docker Compose**

```bash
docker-compose up --build
```

API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: **[http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs)**

---


---

## üèóÔ∏è **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞**

### üî∑ **–°–ª–æ–∏**

* **Routers (api/)** ‚Äì –æ–±—Ä–∞–±–æ—Ç–∫–∞ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤
* **Schemas (schemas/)** ‚Äì Pydantic –º–æ–¥–µ–ª–∏ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
* **Models (models/)** ‚Äì SQLAlchemy –º–æ–¥–µ–ª–∏ –¥–ª—è –ë–î
* **Services (services/)** ‚Äì –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, DAO, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤
* **JWT (ustom_jwt/)** ‚Äì JWT utils, SQLAlchemy –º–æ–¥–µ–ª–∏, DAO 
* **Deps (deps/)** ‚Äì –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ Depends
* **Config (config/)** ‚Äì –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞, engine –±–∞–∑—ã

---

### üî∑ **Auth Flow**

1. **Signup** (`POST /auth/signup`)

   * –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (email + password)
   * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ (email)
   * –°—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: `unverified`

2. **Verify** (`POST /auth/verify`)

   * –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–¥
   * –°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ `verified`

3. **Login** (`POST /auth/login`)

   * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç access –∏ refresh —Ç–æ–∫–µ–Ω—ã

4. **Refresh** (`POST /auth/refresh`)

   * –û–±–Ω–æ–≤–ª—è–µ—Ç access token

5. **Logout** (`POST /auth/logout`)

   * –î–æ–±–∞–≤–ª—è–µ—Ç refresh token –≤ blacklist –∏ —É–¥–∞–ª—è–µ—Ç –∏–∑ whitelist

---

### üî∑ **–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏**

* `GET /users/me` ‚Äì –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
* `GET /users` ‚Äì —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç–æ–ª—å–∫–æ admin)
* `GET /users/{id}` ‚Äì –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID (—Ç–æ–ª—å–∫–æ admin)
* `PATCH /users/{id}` ‚Äì –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–∞–º –∏–ª–∏ admin)
* `DELETE /users/{id}` ‚Äì —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–æ–ª—å–∫–æ admin)

---

### üî∑ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**

* JWT —Ç–æ–∫–µ–Ω—ã —Å–æ scope (`access_token`, `refresh_token`)
* –•—Ä–∞–Ω–µ–Ω–∏–µ refresh —Ç–æ–∫–µ–Ω–æ–≤ –≤ –ë–î
* –¢–∞–±–ª–∏—Ü–∞ blacklist –¥–ª—è –æ—Ç–æ–∑–≤–∞–Ω–Ω—ã—Ö refresh —Ç–æ–∫–µ–Ω–æ–≤
* –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π —á–µ—Ä–µ–∑ bcrypt
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ä–æ–ª—è–º (admin, user)

---

## üìù **–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**

* –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ **Swagger UI** (`/docs`)
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **AsyncSession** –¥–ª—è –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ë–î
* –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ –¥–ª—è –ª—ë–≥–∫–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

---

### üî∑ **–ü–ª–∞–Ω—ã –Ω–∞ —É–ª—É—á—à–µ–Ω–∏–µ**
* –î–æ–±–∞–≤–∏—Ç—å Celery-–∑–∞–¥–∞—á–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–µ–≥—É–ª—è—Ä–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –∏–∑ blacklist)
* –ù–∞–ø–∏—Å–∞—Ç—å Unit –∏ integration tests (pytest)
* –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CI/CD pipeline –¥–ª—è –∞–≤—Ç–æ–¥–µ–ø–ª–æ—è

---